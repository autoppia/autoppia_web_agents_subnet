events {}

http {
    # Basic hardening & limits; tuned low because miners should not stream huge
    # payloads through the proxy.
    client_max_body_size 5m;
    send_timeout 30s;
    proxy_connect_timeout 10s;
    proxy_send_timeout 60s;
    proxy_read_timeout 60s;

    # Allow-list of upstream hosts is enforced outside this template via the
    # resolved $GATEWAY_HOST. Any additional filtering (e.g. path-based) can
    # be added here later.

    server {
        listen 80;

        location / {
            proxy_pass $GATEWAY_URL;
            proxy_set_header Host $GATEWAY_HOST;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;

            # Ensure proper SNI / TLS when proxying to HTTPS upstreams like
            # https://api.openai.com.
            proxy_ssl_server_name on;
            proxy_ssl_name $GATEWAY_HOST;

            # Simple rate limit placeholder (token bucket per IP). Can be tuned or
            # overridden via a custom nginx.conf if needed.
            # limit_req zone=perip burst=10 nodelay;
        }
    }
}
